<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting time series models in package atsar • atsar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Fitting time series models in package atsar">
<meta property="og:description" content="atsar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">atsar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dlm.html">Dynamic linear models in package atsar</a>
    </li>
    <li>
      <a href="../articles/fit_stan.html">Fitting time series models in package atsar</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atsa-es/atsar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fit_stan_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting time series models in package atsar</h1>
                        <h4 class="author">Eric Ward</h4>
            
            <h4 class="date">2021-10-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/atsa-es/atsar/blob/master/vignettes/fit_stan.Rmd"><code>vignettes/fit_stan.Rmd</code></a></small>
      <div class="hidden name"><code>fit_stan.Rmd</code></div>

    </div>

    
    
<div id="fitting-time-series-models" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-time-series-models" class="anchor"></a>Fitting time series models</h1>
<div id="installing-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-packages" class="anchor"></a>Installing packages</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan">rstan</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://atsa-es.github.io/atsar/">atsar</a></span><span class="op">)</span>
<span class="co"># for optimizing stan on your machine,</span>
<span class="co">#rstan_options(auto_write = TRUE)</span>
<span class="co">#options(mc.cores = parallel::detectCores())</span>
<span class="va">mcmc_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n_mcmc <span class="op">=</span> <span class="fl">1000</span>, n_burn <span class="op">=</span> <span class="fl">500</span>, n_chain <span class="op">=</span> <span class="fl">1</span>, n_thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>For data for this lab, we’ll include a dataset on airquality in New York. We’ll load the data and create a couple new variables for future use. For the majority of our models, we’re going to treat ‘Wind’ as the response variable for our time series models.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>
<span class="va">Wind</span> <span class="op">=</span> <span class="va">airquality</span><span class="op">$</span><span class="va">Wind</span> <span class="co"># wind speed</span>
<span class="va">Temp</span> <span class="op">=</span> <span class="va">airquality</span><span class="op">$</span><span class="va">Temp</span> <span class="co"># air temperature</span></code></pre></div>
</div>
<div id="linear-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#linear-regression" class="anchor"></a>1. Linear regression</h2>
<p>We’ll start with the simplest time series model possible: linear regression with only an intercept, so that the predicted values of all observations are the same. There are several ways we can write this equation. First, the predicted values can be written as <span class="math inline">\(E[{Y}_{t}] = u\)</span>. Assuming that the residuals are normally distributed, the model linking our predictions to observed data is written as <span class="math display">\[Y = u + e_{t}, e_{t} \sim Normal(0,\sigma)\]</span></p>
<p>An equivalent way to think about this model is that instead of the residuals as normally distributed with mean zero, we can think of the data <span class="math inline">\(Y\)</span> as being normally distributed with a mean of the intercept, and the same residual standard deviation: <span class="math display">\[Y \sim Normal(E[Y_{t}],\sigma)\]</span> Remember that in linear regression models, the residual error is interpreted as independent and identically distributed observation error.</p>
<p>To run this model using our package, we’ll need to specify the response and predictor variables. The covariate matrix with an intercept only is a matrix of 1s. To double check, you could always look at</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Fitting the model using our function is done with this code,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Nile</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">lm_intercept</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Nile</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Nile</span><span class="op">)</span><span class="op">)</span>,
  model_name <span class="op">=</span> <span class="st">"regression"</span>,mcmc_list<span class="op">=</span><span class="va">mcmc_list</span><span class="op">)</span></code></pre></div>
<p>Coarse summaries of <em>stanfit</em> objects can be examined by typing one of the following</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_intercept</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_intercept</span><span class="op">)</span></code></pre></div>
<p>But to get more detailed output for each parameter, you have to use the <em>extract()</em> function,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html">extract</a></span><span class="op">(</span><span class="va">lm_intercept</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "beta"    "sigma"   "pred"    "log_lik" "lp__"</code></pre>
<p><strong>On your own, try to re-fit a regression model that includes the intercept and a slope, modeling the effect of Wind. What’s the mean wind effect you estimate?</strong></p>
<p>We can then make basic plots or summaries of each of these parameters,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">beta</span>, <span class="fl">40</span>, col<span class="op">=</span><span class="st">"grey"</span>, xlab<span class="op">=</span><span class="st">"Intercept"</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="fit_stan_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">beta</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##       2.5%        50%      97.5% 
## -3.6529938  0.2426497  4.5384432</code></pre>
<p>One of the other useful things we can do is look at the predicted values of our model and overlay the data. The predicted values are <em>pars$pred</em>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">pred</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Predicted values"</span>, lwd<span class="op">=</span><span class="fl">2</span>, 
  ylab<span class="op">=</span><span class="st">"Wind"</span>, ylim<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">pred</span>, <span class="fl">2</span>, <span class="va">quantile</span>,<span class="fl">0.025</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">pred</span>, <span class="fl">2</span>, <span class="va">quantile</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">Wind</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="fit_stan_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div id="burn-in-and-thinning" class="section level3">
<h3 class="hasAnchor">
<a href="#burn-in-and-thinning" class="anchor"></a>Burn-in and thinning</h3>
<p>To illustrate the effects of the burn-in / warmup period, and thinning, we’ll have you re-run the above model, but for just 1 MCMC chain (the default is 3).</p>
<p><strong>Please make a plot of the time series of beta. Based on visual inspection, when does the chain converge? Second, calculate the ACF using acf() - would thinning more be appropriate?</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_intercept</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span>,
  model_name <span class="op">=</span> <span class="st">"regression"</span>, 
  mcmc_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n_mcmc <span class="op">=</span> <span class="fl">1000</span>, n_burn <span class="op">=</span> <span class="fl">1</span>, n_chain <span class="op">=</span> <span class="fl">1</span>, n_thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="linear-regression-with-correlated-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#linear-regression-with-correlated-errors" class="anchor"></a>2. Linear regression with correlated errors</h2>
<p>In our first model, the errors were independent in time. We’re going to modify this to model autocorrelated errors. Autocorrelated errors are widely used in ecology and other fields – for a greater discussion, see Morris and Doak (2002) Quantitative Conservation Biology. To make the deviations autocorrelated, we start by defining the deviation in the first time step, <span class="math inline">\({e}_{1} = {Y}_{1} - {u}\)</span>. The expectation of <span class="math inline">\({Y_t}\)</span> in each time step is then written as <span class="math display">\[E[{Y_t}] = u + \phi * e_{t-1}\]</span></p>
<p>In addition to affecting the expectation, the correlation parameter <span class="math inline">\(\phi\)</span> also affects the variance of the errors, so that <span class="math display">\[{ \sigma  }^{ 2 }={ \psi  }^{ 2 }\left( 1-{ \phi  }^{ 2 } \right)\]</span> Like in our first model, we assume that the data follows a normal likelihood (or equivalently that the residuals are normally distributed), <span class="math inline">\({Y_t} = E[{Y_t}] + {e}_{t}\)</span>, or <span class="math inline">\({Y_t} \sim Normal(E[{Y_t}], \sigma)\)</span>. Thus, it is possible to express the subsequent deviations as <span class="math inline">\({e}_{t} = {Y}_{t} - E[{Y_t}]\)</span>, or equivalently as <span class="math inline">\({e}_{t} = {Y}_{t} - {u} -\phi * {e}_{t-1}\)</span>.</p>
<p>We can fit this regression with autocorrelated errors by changing the model name to ‘regression_cor’</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_intercept_cor</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span>,
  model_name <span class="op">=</span> <span class="st">"regression_cor"</span>, 
  mcmc_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n_mcmc <span class="op">=</span> <span class="fl">1000</span>, n_burn <span class="op">=</span> <span class="fl">1</span>, n_chain <span class="op">=</span> <span class="fl">1</span>, n_thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="random-walk-model" class="section level2">
<h2 class="hasAnchor">
<a href="#random-walk-model" class="anchor"></a>3. Random walk model</h2>
<p>All of the previous three models can be interpreted as observation error models. Switching gears, we can alternatively model error in the state of nature, creating process error models. A simple process error model that many of you may have seen before is the random walk model. In this model, the assumption is that the true state of nature (or latent states) are measured perfectly. Thus, all uncertainty is originating from process variation (for ecological problems, this is often interpreted as environmental variation). For this simple model, we’ll assume that our process of interest (in this case, daily wind speed) exhibits no daily trend, but behaves as a random walk.</p>
<p><span class="math display">\[E[{Y_t}] = Y_{t-1} + e_{t-1}\]</span></p>
<p>And the <span class="math inline">\({e}_{t} \sim Normal(0, \sigma)\)</span>. Remember back to the autocorrelated model (or MA(1) models) that we assumed that the errors <span class="math inline">\(e_t\)</span> followed a random walk. In contrast, the AR(1) model assumes that the errors are independent, but that the state of nature follows a random walk. Note also that this model as written doesn’t include a drift term (this can be turned on / off using the <em>est_drift</em> argument).</p>
<p><strong>Please fit the random walk model to the temperature data. Our function can do this by using model_name = ‘rw’. Once you’ve fitted the model, plot the predicted values and 95% CIs, as we did above in the regression model.</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rw</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, est_drift <span class="op">=</span> <span class="cn">FALSE</span>, model_name <span class="op">=</span> <span class="st">"rw"</span>,mcmc_list<span class="op">=</span><span class="va">mcmc_list</span><span class="op">)</span></code></pre></div>
</div>
<div id="autoregressive-models" class="section level2">
<h2 class="hasAnchor">
<a href="#autoregressive-models" class="anchor"></a>4. Autoregressive models</h2>
<p>A variation of the random walk model described previously is the autoregressive time series model of order 1, AR(P=1). This model is essentially the same as the random walk model but it introduces an estimated coefficient, which we’ll call <span class="math inline">\(\phi\)</span>. The parameter <span class="math inline">\(\phi\)</span> controlls the degree to which the random walk reverts to the mean – when <span class="math inline">\(\phi\)</span> = 1, the model is identical to the random walk, but at smaller values, the model will revert back to the mean (which in this case is zero). Also, <span class="math inline">\(\phi\)</span> can take on negative values, which we’ll discuss more in future lectures. The math to describe the AR(P=1) time series model is: <span class="math display">\[E[{Y_t}] = \phi * Y_{t-1} + e_{t-1}\]</span>.</p>
<p><strong>Our function can fit higher order AR models, but for now we just want you to fit an AR model and make a histogram of phi. </strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ar1</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, 
  model_name <span class="op">=</span> <span class="st">"ar"</span>, est_drift<span class="op">=</span><span class="cn">FALSE</span>, P <span class="op">=</span> <span class="fl">1</span>,mcmc_list<span class="op">=</span><span class="va">mcmc_list</span><span class="op">)</span></code></pre></div>
<p><strong>To see the effect of this increased flexibility in estimating the autocorrelation, make a plot of the predictions from the AR(P=1) model and the RW model</strong></p>
</div>
<div id="state-space-models" class="section level2">
<h2 class="hasAnchor">
<a href="#state-space-models" class="anchor"></a>5. State-space models</h2>
<p>At this point, we’ve fit models with observation or process error, but we haven’t tried to estimate both simultaneously. We will do so here, and introduce some new notation to describe the process model and observation model. We use the notation <span class="math inline">\({x_t}\)</span> to denote the latent state or state of nature (which is unobserved) at time <span class="math inline">\(t\)</span> and <span class="math inline">\({y_t}\)</span> to denote the observed data. For introductory purposes, we’ll make the process model autoregressive (similar to our AR(1) model),</p>
<p><span class="math display">\[x_{t} = \phi * x_{t-1} + e_{t-1}; e_{t-1} \sim Normal(0,q)\]</span></p>
<p>For the process model, there are a number of ways to parameterize the first ‘state’, and we’ll talk about this more in the class, but for the sake of this model, we’ll place a vague weakly informative prior on <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_1 \sim Normal(0, 0.01)\)</span>.Second, we need to construct an observation model linking the estimate unseen states of nature <span class="math inline">\(x_t\)</span> to the data <span class="math inline">\(Y_t\)</span>. For simplicitly, we’ll assume that the observation errors are indepdendent and identically distributed, with no observation component. Mathematically, this model is <span class="math display">\[Y_t \sim Normal(x_t, r)\]</span> In the two above models, we’ll refer to <span class="math inline">\(q\)</span> as the standard deviation of the process variance and <span class="math inline">\(r\)</span> as the standard deviation of the observation error variance</p>
<p><strong>For this model, fit the above model with and without the autoregressive parameter <span class="math inline">\(\phi\)</span> and compare the estimated process and observation error variances. Code examples are given below</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ss_ar</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, est_drift<span class="op">=</span><span class="cn">FALSE</span>, model_name <span class="op">=</span> <span class="st">"ss_ar"</span>,mcmc_list<span class="op">=</span><span class="va">mcmc_list</span><span class="op">)</span>
<span class="va">ss_rw</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_stan.html">fit_stan</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, est_drift<span class="op">=</span><span class="cn">FALSE</span>, model_name <span class="op">=</span> <span class="st">"ss_rw"</span>,mcmc_list<span class="op">=</span><span class="va">mcmc_list</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eric J. Ward, Mark D. Scheuerell, Elizabeth E. Holmes, Kiva L. Oken.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
